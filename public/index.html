<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Import mails</title>

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery-ui.theme.min.css"></script>
    <script src="js/util.js"></script>
    <script src="js/pako.js"></script>
    <script src="js/async.js"></script>

    <script src="js/archiveProcessor.js"></script>
    <script src="js/resources.js"></script>
    <style>

        body {
            font-family: Verdana;
            font-size: 14px;
        }

        input, button, div {
            margin: 10px;
        }

        #submitButton {
        / / visibility: hidden;
        }

        #dropZone {
            width: 300px;
            height: 200px;
            border-style: groove;
            border-width: 3px;
            background-color: #aaaaaa;
        }

        .text {
            padding: 20px;
        }

        .title {
            font-size: 18px;
            font-weight: bold;
        }

        .version {
            font-size: 10px;
            font-weight: normal;
        }

    </style>

    <script>
        var messageText = "";
        var log = "";
        var currentLang = "FR";


        $(function () {

            var ajaxCallBack = function (err, result) {

            }


            //**************************************************************when archive drop on div**************************************


            dropZone.addEventListener('dragover', function (e) {
                e.stopPropagation();
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            });


            dropZone.addEventListener("drop", function (event) {

                messageText = "";
                totalCountMails = 0;
                dirCountMails = 0;
                stopAsync = false;
                setMessage(messageText, "black")
                event.preventDefault();
                if (!checkForm()) {
                    return;
                }

                var data = event.dataTransfer.items;
                archiveProcessor.readData(data, "checkRules", function (err, result) {
                    if (err) {
                        messageText += err[currentLang];
                        setMessage(messageText, "red")
                        console.log(err);
                        return;
                    }
                    var infos=JSON.stringify(result,null,2).replace(/\n/g,"<br>");

                    setMessage("<B>"+resources.Message_archiveIsUploaded[currentLang]+"</B>"+archiveProcessor.totalCountUploadedMails+"/"+archiveProcessor.totalCountMails+"<br>"+infos);


                });
            })
        })


        function checkForm() {
            currentLevel = 0;
            var file = $("#fileInput").val();
            if (file == null || file == "") {

                sender = $("#senderInput").val();
                if (sender == null || sender == "") {
                    setMessage("Saisisssez un expediteur et déposez l'archive à nouveau sur la zone", "red");
                    return false;
                }
                archiveProcessor.sender = sender;
                archiveProcessor.mailMaxSize = parseInt($("#mailMaxSize").val());
                archiveProcessor.currentLang = currentLang;


                return true;
            }
        }

        function setMessage(message, color) {
            if (color) {
                $("#message").css("color", color);
            }
            $("#message").html(message);
        }


    </script>

</head>
<body>
<p align="center">
    <span class="title">ATD Quart Monde    Utilitaire d'archivage des mails exportés depuis thunderbird</span>
    <br><span class="version">version 0.0.1 (test)</span>


<table align="center">
    <tr>
        <td>
            Nom de l'expediteur
        </td>
        <td>
            <input id="senderInput" name="sender" value="XXXXXXXXXXXXXXX">
            Taille maxi pour l'archivage d'un mail (ko) <input id="mailMaxSize" value="500" size="5">
        </td>
    </tr>
    <tr>
        <td colspan="2">

            <div id="dropZone">deposez le fichier ici</div>
        </td>
        <td>
            <div id="message">statut...</div>
        </td>
    </tr>
</table>


<br>
<br>
<br>
<br>
<br>
<br>
<br>
<span class="title">Mode d'emploi</span>
<button onclick="$('.text').css('visibility','hidden')">fermer</button>


<div class="text">
    Pour envoyer au service des archives vos archives de mails depusi Thunderbird tout en conservant l'arborescence à 3
    niveaux des dossiers dans lesquels il sont classés vous devez suivre les étapes suivantes
    <ol>
        <li>
            <b> installez l'add on ImportExportTools </b><br>
            <ul>
                <li>
                    téléchargez le plugin <a
                        href="https://addons.mozilla.org/en-US/thunderbird/addon/importexporttools/">ici</a>
                </li>
                <li>
                    installez le plugin<br>
                    <img src="./images/mailArchiver1.png" width="300px"><img src="./images/mailArchiver2.png"
                                                                             width="300px">
                </li>
                <li>
                    redemarrez thunderbird
                </li>

            </ul>

        </li>

        <li>
            <b>exportez votre arborescence de mails </b>

            <img src="./images/mailArchiver1.png" width="300px"><img src="./images/mailArchiver3.png" width="300px">


        </li>

        <li>
            <b>compressez le dossier exporté dans un fichier .zip </b>

            <img src="./images/mailArchiver1.png" width="300px"><img src="./images/mailArchiver3.png" width="300px">


        </li>

        <li>
            <b>envoyez l'archive zip en la téléchargeant dans l'interface ci-dessus</b>

        </li>


    </ol>


</div>


</p>


</body>
</html>